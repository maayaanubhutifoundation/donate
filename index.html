<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Donate to Maaya Anubhuti Foundation</title>

  <!-- Firebase (unchanged) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <!-- Turnstile (unchanged) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root{ --maf-violet:#7846e4; --maf-accent:#ff9900; }
    html,body{ font-size:18px; }
    body{ background-color: var(--maf-violet); padding:40px 10px; }
    .page-wrap{ max-width: 1140px; margin: 0 auto; }

    /* Header band */
    .hero-card{
      background:#fff; border-radius:12px; padding:20px 24px; box-shadow:0 6px 20px rgba(0,0,0,.08);
    }
    .brand-title{ color:#e68a00; margin:0 0 2px; font-weight:700; }

    .ribbon{
      color:var(--maf-violet); font-size:.95rem; font-weight:600;
      border-left:4px solid #007bff; padding-left:10px;
    }

    /* Unified two-column card (same width as header) */
    .unified-card{
      background:#fff; border-radius:12px; box-shadow:0 10px 28px rgba(0,0,0,.12);
      padding: 18px 18px; margin-top:14px;
    }
    .divider-lg{
      border-left:1px solid #eee;
    }

    /* Form card look (inside unified card) */
    .form-inner{ max-width: 560px; } /* gives the form visual weight (~60%) */
    .form-control, .form-select{
      border:2px solid var(--maf-violet) !important;
      border-radius:12px !important;
      box-shadow: inset 0 0 0 2px rgba(120,70,228,.08);
      font-size:1rem;
    }
    .form-control:focus, .form-select:focus{
      border-color:#5129d6 !important;
      box-shadow:0 0 0 4px rgba(120,70,228,.20), inset 0 0 0 2px rgba(120,70,228,.08);
      outline:none;
    }

    /* Floating labels */
    .form-floating > label{ padding-left:.9rem; color:#495057; }
    .form-floating .form-control::placeholder{ color:transparent; }

    /* Asterisk for required labels */
    .req::after{
      content:" *"; color:#d32f2f; font-weight:700;
    }

    /* Mobile with +91 */
    .input-group-text{ font-weight:700; }

    /* Buttons */
    .btn-primary{ background-color: var(--maf-accent); border:none; }
    .btn-primary:hover{ background-color:#e68a00; }

    /* OTP box */
    #otpSection{ margin-bottom:12px; background:#eef5ff; padding:12px; border-radius:8px; display:none; }

    /* Turnstile spacing */
    .cf-turnstile{ margin-top:8px; }

    /* Success band */
    #authConfirmed{
      display:none; margin-top:20px; padding:12px;
      background:#e8f8ec; border-left:5px solid green; color:#155724; font-weight:700;
    }
    #donationOptions{ display:none; margin-top:20px; }

    /* 80G blocks default states (JS will open by default Yes) */
    #panWrap, #addrBlock{ display:none; }

    /* Right column content */
    .about-title{ color:var(--maf-violet); font-weight:700; }
    .about-box p{ margin-bottom:.7rem; }
    blockquote{
      border-left:4px solid #eee; padding-left:.75rem; margin:.5rem 0; color:#333;
      font-size:.95rem;
    }

    /* Responsive */
    @media (max-width: 991.98px){
      .divider-lg{ border-left:none; border-top:1px solid #eee; margin-top:14px; padding-top:14px; }
      .form-inner{ max-width: 100%; }
      #otpSection{ display:block; } /* match earlier behaviour once OTP sent */
    }
  </style>
</head>
<body>

  <div class="page-wrap">

    <!-- Header / Intro -->
    <div class="hero-card">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h1 class="h3 brand-title">Support Maaya Anubhuti Foundation üíõ</h1>
          <p class="mb-2" style="color:#555; font-size:.95rem;">
            Your generous donation helps us care for the elderly, build a compassionate environment, and train youth to serve with dignity.
          </p>
        </div>
        <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=375,h=429,fit=crop/A0xj3j1bO7C10DBz/logo_maf-Awv9zveMloUr16Ba.jpeg"
             alt="MAF Logo" style="height:56px; border-radius:6px;">
      </div>

      <!-- Quotes -->
      <div class="mt-2" style="color:#333; font-size:.95rem;">
        <div><strong>‚ÄúIt's not how much we give but how much love we put into giving.‚Äù</strong> ‚Äî Mother Teresa</div>
        <div><strong>‚ÄúThe best way to find yourself is to lose yourself in the service of others.‚Äù</strong> ‚Äî Mahatma Gandhi</div>
        <div><strong>‚ÄúWe make a living by what we get, but we make a life by what we give.‚Äù</strong> ‚Äî Winston Churchill</div>
      </div>

      <!-- 80G toggle (requested placement) -->
      <div class="mt-3">
        <label class="form-label fw-semibold me-2">I require 80G Tax Exemption Certificate:</label>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="need80g" id="need80gYes" value="yes" checked>
          <label class="form-check-label" for="need80gYes">Yes</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="need80g" id="need80gNo" value="no">
          <label class="form-check-label" for="need80gNo">No</label>
        </div>

        <!-- Undertaking now directly under Yes/No -->
        <div class="mt-2" id="undertakingWrap" style="display:none;">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="undertaking80g">
            <label class="form-check-label req" for="undertaking80g">
              I confirm my PAN and address are correct and consent to verification for 80G reporting.
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Unified two-column card -->
    <div class="unified-card">
      <div class="row g-3 align-items-start">
        <!-- LEFT (60%): Form -->
        <div class="col-12 col-lg-7">
          <form id="donationForm" class="form-inner">

            <!-- Name (floating; dynamic label/asterisk) -->
            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="name" placeholder="Name as per PAN" required>
              <label for="name" id="nameLabel" class="req">Name as per PAN</label>
            </div>

            <!-- Mobile with +91 -->
            <div class="mb-3">
              <label class="form-label req">Mobile Number</label>
              <div class="input-group">
                <span class="input-group-text">+91</span>
                <input type="tel" class="form-control" id="mobile" pattern="[0-9]{10}" placeholder="10-digit number" required>
              </div>
            </div>

            <!-- OTP box (appears after OTP is sent) -->
            <div id="otpSection">
              <label for="otp" class="form-label">Enter OTP</label>
              <input type="text" id="otp" class="form-control mt-1" inputmode="numeric" maxlength="6"/>
              <div id="otpFeedback" class="fw-bold mt-2"></div>
            </div>

            <!-- Email -->
            <div class="form-floating mb-3">
              <input type="email" class="form-control" id="email" placeholder="Email (Optional)">
              <label for="email">Email (Optional)</label>
            </div>

            <!-- PAN -->
            <div class="form-floating mb-2" id="panWrap">
              <input type="text" class="form-control" id="pan" placeholder="ABCDE1234F" style="text-transform:uppercase;" maxlength="10">
              <label for="pan" id="panLabel" class="req">PAN (Required for 80G receipt)</label>
            </div>
            <div class="mb-3" id="panHint" style="font-size:.9rem; color:#555;"></div>

            <!-- Address segmented -->
            <div id="addrBlock">
              <div class="form-floating mb-3">
                <select class="form-select" id="country">
                  <option value="">Select Country</option>
                  <option value="India" selected>India</option>
                </select>
                <label for="country" id="countryLabel" class="req">Country</label>
              </div>

              <div class="form-floating mb-3">
                <select class="form-select" id="state">
                  <option value="">Select State</option>
                  <!-- States & UTs -->
                  <option>Andhra Pradesh</option><option>Arunachal Pradesh</option><option>Assam</option>
                  <option>Bihar</option><option>Chhattisgarh</option><option>Goa</option><option>Gujarat</option>
                  <option>Haryana</option><option>Himachal Pradesh</option><option>Jharkhand</option>
                  <option>Karnataka</option><option>Kerala</option><option>Madhya Pradesh</option>
                  <option>Maharashtra</option><option>Manipur</option><option>Meghalaya</option>
                  <option>Mizoram</option><option>Nagaland</option><option>Odisha</option>
                  <option>Punjab</option><option>Rajasthan</option><option>Sikkim</option>
                  <option>Tamil Nadu</option><option>Telangana</option><option>Tripura</option>
                  <option>Uttar Pradesh</option><option>Uttarakhand</option><option>West Bengal</option>
                  <option>Andaman and Nicobar Islands</option><option>Chandigarh</option>
                  <option>Dadra and Nagar Haveli and Daman and Diu</option><option>Delhi</option>
                  <option>Jammu and Kashmir</option><option>Ladakh</option><option>Lakshadweep</option>
                  <option>Puducherry</option>
                </select>
                <label for="state" id="stateLabel" class="req">State</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="city" placeholder="City">
                <label for="city" id="cityLabel" class="req">City</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="address" placeholder="House/Colony/Street">
                <label for="address" id="addressLabel" class="req">Address (HN/Colony/Street)</label>
              </div>

              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="pin" placeholder="PIN" inputmode="numeric" maxlength="6">
                <label for="pin" id="pinLabel" class="req">PIN</label>
              </div>
            </div>

            <!-- Message -->
            <div class="form-floating mb-3">
              <textarea class="form-control" id="message" placeholder="Message (Optional)" style="height: 80px"></textarea>
              <label for="message">Message (Optional)</label>
            </div>

            <!-- Instruction -->
            <div class="mb-2 ribbon" style="border-left-color:#007bff;">
              Authenticate your mobile number by pressing <strong>Submit</strong> to reveal QR, UPI and bank details.
            </div>

            <!-- Consents -->
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="declaration" required>
              <label class="form-check-label req" for="declaration">
                I hereby declare I am an Indian citizen
                <span id="more" style="display:none;"> donating my own funds. I consent to contact via WhatsApp/email/SMS for donation updates and receipts.</span>
                <button type="button" id="readToggle" class="btn btn-link p-0" style="font-size:.85rem;">Read More</button>
              </label>
            </div>

            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="anonymous">
              <label class="form-check-label" for="anonymous">I opt to remain anonymous and not have my name published on the website.</label>
            </div>

            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="receipt">
              <label class="form-check-label" for="receipt">I would like to receive the receipt via WhatsApp/email.</label>
            </div>

            <div class="cf-turnstile" data-sitekey="0x4AAAAAABnuBDDS5ho0ShrZ"></div>
            <button type="button" class="btn btn-primary w-100 mt-2" id="submitBtn">Submit</button>
          </form>
        </div>

        <!-- RIGHT (40%): Text / Tax note / Quotes / FAQ -->
        <div class="col-12 col-lg-5 about-box divider-lg">
          <h2 class="h5 about-title">About your contribution</h2>
          <p>Your support nourishes underprivileged elders with meals and clothing today, and builds the foundation for our eco-friendly senior living centre tomorrow.</p>

          <div class="mt-3">
            <div class="ribbon" style="border-left-color:#ddd; color:#222;">
              <div><strong>YOUR CONTRIBUTIONS ARE ELIGIBLE FOR 50% TAX BENEFIT UNDER SECTION 80G.</strong></div>
              <div>PAN: <strong>AATCM5136F</strong> &nbsp; | &nbsp; 80G URN: <strong>AATCM5136FF20251</strong></div>
            </div>

            <blockquote>‚ÄúIt's not how much we give but how much love we put into giving.‚Äù ‚Äî Mother Teresa</blockquote>
            <blockquote>‚ÄúThe best way to find yourself is to lose yourself in the service of others.‚Äù ‚Äî Mahatma Gandhi</blockquote>
            <blockquote>‚ÄúWe make a living by what we get, but we make a life by what we give.‚Äù ‚Äî Winston Churchill</blockquote>

            <p class="mt-3 mb-0">
              üëâ For tax-benefit details, see our <a href="https://www.maayaanubhuti.org/support" target="_blank">Donation FAQ</a>.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Success + options -->
    <div id="authConfirmed">‚úÖ Mobile number authenticated. You may now proceed with your donation.</div>

    <div id="donationOptions">
      <h5 class="mt-3 text-white">Donation Options</h5>
      <div class="row text-center">
        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <div style="font-size:30px;">üí≥</div>
              <h6 class="card-title mt-2">Scan & Pay</h6>
              <img id="qrCodeImage" src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=384,h=448,fit=crop/A0xj3j1bO7C10DBz/qr_code-m6Lb0BlRRqs7MEGd.png" alt="QR" class="img-fluid" style="max-width:120px;">
              <br>
              <button onclick="downloadQR()" class="btn btn-sm btn-outline-primary mt-2">Download QR Code</button>
              <small class="d-block mt-1 text-muted" style="font-size:.85rem;">To use this QR on the same phone, download it and then upload it from your UPI app.</small>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <div style="font-size:30px;">üî¢</div>
              <h6 class="card-title mt-2">UPI ID</h6>
              <p id="upiText">9599914274@idbi</p>
              <button onclick="copyText('upiText')" class="btn btn-sm btn-outline-primary">Copy UPI ID</button>
            </div>
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <div style="font-size:30px;">üè¶</div>
              <h6 class="card-title mt-2">Bank Transfer</h6>
              <small>
                A/C No: <span id="accNo">0873102000012698</span><br>
                IFSC: IBKL0000873<br>
                Bank: IDBI Bank<br>
                Branch: Indirapuram, Ghaziabad
              </small><br>
              <button onclick="copyText('accNo')" class="btn btn-sm btn-outline-primary mt-2">Copy Account No</button>
            </div>
          </div>
        </div>

        <div class="col-md-6 offset-md-3 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <div style="font-size:30px;">üìÆ</div>
              <h6 class="card-title mt-2">Offline (Cheque/DD)</h6>
              <small>
                Please send your Cheque/DD in favor of:<br>
                <strong>Maaya Anubhuti Foundation</strong><br>
                Address: 3A-232, Rachna, Vaishali, Ghaziabad, UP ‚Äì 201010
              </small>
            </div>
          </div>
        </div>
      </div>

      <p class="text-white-50 small mt-2">
        Maaya Anubhuti Foundation (Section 8, Licence #169918, CIN U86900UP2025NPL226294, PAN AATCM5136F) operates with transparency and integrity.
      </p>
    </div>

  </div><!-- /page-wrap -->

  <div id="recaptcha-container" style="display:none;"></div>

  <script>
    // Read more toggle
    document.getElementById("readToggle").addEventListener("click", () => {
      const more = document.getElementById("more");
      const btn  = document.getElementById("readToggle");
      const show = more.style.display === "none";
      more.style.display = show ? "inline" : "none";
      btn.textContent = show ? "Read Less" : "Read More";
    });

    function copyText(id){
      const text=document.getElementById(id).innerText;
      navigator.clipboard.writeText(text).then(()=>alert("Copied: "+text));
    }
    function downloadQR(){
      const link=document.createElement('a');
      link.href=document.getElementById('qrCodeImage').src;
      link.download='MAF_QR_Code.png';
      document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }

    // Firebase (unchanged)
    const firebaseConfig = {
      apiKey: "AIzaSyAG6BcfLCiBG4nX2dqa0YDCqtbgiET4qQg",
      authDomain: "maaya-donation-project.firebaseapp.com",
      projectId: "maaya-donation-project",
      storageBucket: "maaya-donation-project.appspot.com",
      messagingSenderId: "893542409484",
      appId: "1:893542409484:web:6ce0ff5bc7e51de69f1529"
    };
    firebase.initializeApp(firebaseConfig);

    let confirmationResult;
    const submitBtn = document.getElementById("submitBtn");
    const otpSection = document.getElementById("otpSection");
    const otpInputEl = document.getElementById("otp");
    const otpFeedback = document.getElementById("otpFeedback");
    const authConfirmed = document.getElementById("authConfirmed");
    const donationForm = document.getElementById("donationForm");
    const donationOptions = document.getElementById("donationOptions");

    // 80G controls
    const need80gYes = document.getElementById('need80gYes');
    const need80gNo  = document.getElementById('need80gNo');
    const nameInput  = document.getElementById('name');
    const nameLabel  = document.getElementById('nameLabel');

    const undertakingWrap = document.getElementById('undertakingWrap');
    const undertaking80g  = document.getElementById('undertaking80g');

    const panWrap  = document.getElementById('panWrap');
    const panInput = document.getElementById('pan');
    const panHint  = document.getElementById('panHint');

    const country = document.getElementById('country');
    const state   = document.getElementById('state');
    const city    = document.getElementById('city');
    const address = document.getElementById('address');
    const pin     = document.getElementById('pin');

    function need80gValue(){
      const r = document.querySelector('input[name="need80g"]:checked');
      return r ? r.value : 'yes';
    }

    // PAN helpers
    const PAN_REGEX=/^[A-Z]{5}[0-9]{4}[A-Z]$/;
    const getPanTypeChar = p => (p||'').toUpperCase().charAt(3);
    const getFifthChar   = p => (p||'').toUpperCase().charAt(4);
    const surnameInitial = n => ((n||'').trim().split(/\s+/).pop() || '').charAt(0).toUpperCase();
    const entityInitial  = n => (((n||'').trim().match(/[A-Za-z]/) || [''])[0] || '').toUpperCase();
    const typeExplain = t => ({P:'Individual',C:'Company',H:'HUF',F:'Firm/LLP',A:'AOP',B:'BOI',T:'Trust',L:'Local Authority',J:'Artificial Juridical Person',G:'Government'})[t]||'';

    function validatePAN(){
      if(need80gValue()!=='yes'){ panInput.setCustomValidity(''); panHint.textContent=''; return; }
      const pan = (panInput.value||'').toUpperCase(); panInput.value = pan;

      if(!PAN_REGEX.test(pan)){
        panInput.setCustomValidity('Enter a valid PAN (e.g., ABCDE1234F).');
        panHint.textContent='Format: 5 letters + 4 digits + 1 letter.';
        return;
      }
      const t = getPanTypeChar(pan);
      const fifth = getFifthChar(pan);
      const expected = (t==='P') ? surnameInitial(nameInput.value) : entityInitial(nameInput.value);

      if(!expected){
        panInput.setCustomValidity('Please enter your '+(t==='P'?'surname':'name')+' so its initial matches PAN 5th letter.');
        panHint.textContent = 'PAN Type '+t+' ('+typeExplain(t)+'). 5th letter must match your '+(t==='P'?'surname':'name')+' initial.';
        return;
      }
      if(fifth !== expected){
        panInput.setCustomValidity('Name mismatch: expected "'+expected+'", got "'+fifth+'".');
        panHint.textContent = 'Mismatch: expected "'+expected+'", got "'+fifth+'".';
        return;
      }
      panInput.setCustomValidity('');
      panHint.textContent = '‚úî PAN verified ('+typeExplain(t)+').';
    }
    panInput.addEventListener('input', validatePAN);
    nameInput.addEventListener('input', validatePAN);

    function setReq(el, on){ if(!el) return; on ? el.setAttribute('required','required') : el.removeAttribute('required'); }
    function markLabel(labelEl, on){
      if(!labelEl) return;
      labelEl.classList.toggle('req', !!on);
    }
    function toggleAddrRequired(on){
      setReq(country,on); setReq(state,on); setReq(city,on); setReq(address,on); setReq(pin,on);
      markLabel(document.getElementById('countryLabel'), on);
      markLabel(document.getElementById('stateLabel'), on);
      markLabel(document.getElementById('cityLabel'), on);
      markLabel(document.getElementById('addressLabel'), on);
      markLabel(document.getElementById('pinLabel'), on);
    }

    function toggle80G(){
      const need = need80gValue()==='yes';

      undertakingWrap.style.display = need ? 'block' : 'none';
      setReq(undertaking80g, need);
      markLabel(document.querySelector('label[for="undertaking80g"]'), need);

      panWrap.style.display = need ? 'block' : 'none';
      setReq(panInput, need);
      markLabel(document.getElementById('panLabel'), need);

      document.getElementById('addrBlock').style.display = 'block'; // always visible
      toggleAddrRequired(need);

      nameLabel.textContent = need ? 'Name as per PAN' : 'Full Name';
      markLabel(nameLabel, true); // Name always required
      if(!need){
        undertaking80g.checked = false;
        panInput.value=''; panInput.setCustomValidity(''); panHint.textContent='';
      }
    }
    document.getElementById('need80gYes').addEventListener('change', toggle80G);
    document.getElementById('need80gNo').addEventListener('change', toggle80G);
    toggle80G(); // initialize (default Yes)

    // Simple address check when needed
    function validateAddressIfNeeded(){
      const need = need80gValue()==='yes';
      if(!need) return true;
      if(!country.value) { country.focus(); return false; }
      if(!state.value)   { state.focus();   return false; }
      if(!city.value.trim()) { city.focus(); return false; }
      if(!address.value.trim()) { address.focus(); return false; }
      if(!/^\d{6}$/.test(pin.value||'')) { pin.focus(); alert('Please enter a valid 6-digit PIN.'); return false; }
      return true;
    }

    // Read more / OTP helpers
    const readBtn = document.getElementById("readToggle");
    readBtn.addEventListener("click", () => {
      const more = document.getElementById("more");
      const show = more.style.display === "none";
      more.style.display = show ? "inline" : "none";
      readBtn.textContent = show ? "Read Less" : "Read More";
    });

    otpInputEl && otpInputEl.addEventListener("input", () => {
      if (otpInputEl.value.length === 6 && confirmationResult) submitBtn.click();
    });

    // Submit handler
    submitBtn.addEventListener("click", () => {
      const mobileValue = document.getElementById("mobile").value;
      if (!/^([6-9])\d{9}$/.test(mobileValue)) return alert("Please enter a valid 10-digit mobile number starting with 6‚Äì9.");
      if (!document.getElementById("declaration").checked) return alert("Please accept the declaration.");

      if(need80gValue()==='yes'){
        if(!undertaking80g.checked) return alert("Please confirm the 80G undertaking.");
        validatePAN();
        if(panInput.validationMessage){ alert(panInput.validationMessage); return; }
        if(!validateAddressIfNeeded()) return;
      }

      const phone = "+91" + mobileValue;

      // Start OTP if not started
      if (!confirmationResult) {
        submitBtn.disabled = true; submitBtn.textContent = "Sending OTP...";
        try {
          window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });
          window.recaptchaVerifier.verify().then(() => {
            return firebase.auth().signInWithPhoneNumber(phone, window.recaptchaVerifier);
          }).then(result => {
            confirmationResult = result;
            document.getElementById('otpSection').style.display = 'block';
            otpInputEl.focus();
            submitBtn.disabled = false; submitBtn.textContent = "Submit OTP for Donation";
          }).catch(err => {
            alert("Error sending OTP: " + err.message);
            submitBtn.disabled = false; submitBtn.textContent = "Submit";
          });
        } catch (e) {
          alert("Unexpected error. Please reload and try again.");
          submitBtn.disabled = false; submitBtn.textContent = "Submit";
        }
        return;
      }

      // Confirm OTP then reveal options + send to Make
      confirmationResult.confirm(otpInputEl.value).then(() => {
        authConfirmed.style.display = "block";
        donationForm.style.display = "none";
        donationOptions.style.display = "block";

        const wants80g = (need80gValue()==='yes');
        const panVal = wants80g ? (panInput.value||'').toUpperCase() : '';
        const panType = panVal ? panVal.charAt(3) : '';

        fetch("https://hook.eu2.make.com/lsq9xd18wvu7xqueguw0jx55qry344q4", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            timestamp: new Date().toISOString(),
            name: document.getElementById("name").value,
            phone: document.getElementById("mobile").value,
            email: document.getElementById("email").value || "",
            pan: panVal,
            PAN_Type: panType,
            country: country.value || "",
            state:   state.value   || "",
            city:    city.value    || "",
            address: address.value || "",
            pin:     pin.value     || "",
            message: document.getElementById("message").value || "",
            anonymous: document.getElementById("anonymous").checked ? "Yes" : "No",
            receipt: document.getElementById("receipt").checked ? "Yes" : "No",
            status: "Verified",
            verified: "Yes",
            want_80G: wants80g ? "Yes" : "No"
          })
        }).then(() => console.log("‚úÖ Sent to Make.com"))
          .catch(err => console.error("‚ùå Make error:", err));

      }).catch(err => {
        otpFeedback.textContent = "Wrong OTP";
        otpFeedback.style.color = "red";
      });
    });
  </script>

  <div id="recaptcha-container" style="display:none;"></div>
</body>
</html>
